<!DOCTYPE html>
<html>
	<head>
		<title>Flowdesk</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<style type="text/css">
			* { padding: 0; margin: 0; border: 0; } 
			body { background-color: #eaebed; }
			#maintitle_wrapper {
				position : fixed;
				/* display : inline-block; */
				top : 50px;
				left : 50px;
				height : 160px;
				border-left : 20px solid #db021f;
			}
			#maintitle_1 {
				position : fixed;
				top : 40px;
				left : 80px;
				font-family : "Arial Black";
				color : black;
				font-size : 65px;
			}
			#maintitle_2 {
				position : fixed;
				top : 125px;
				left : 80px;
				font-family : "Arial Black";
				color : black;
				font-size : 65px;
			}
			#subtitle_wrapper {
				position : fixed;
				/* display : inline-block; */
				top : 230px;
				left : 50px;
				height : 50px;
				border-left : 20px solid #1700ba; /* #0669d3; */
			}
			#subtitle {
				position : fixed;
				top : 234px;
				left : 85px;
				font-family : "Arial Black";
				color : black;
				font-size : 25px;  
			}
			.row {
				position : relative;
				margin-top : 30px;
				margin-bottom : 30px;
				height : 400px; 	/* dynamically scaled as the post content is added */
				width : 100%;
				min-width : 400px; 	/* minimum width of window */
			}
			.post_placeholder {
				position : relative;
				margin : 0 auto;
				height : 100%;			/* fixed to "row" height */
				width : 400px;						
			}
			.post_wrapper {
				position :relative;
                background-color : white;
  				margin : 0 auto;
  				width : 90%;
				height : 90%;
				border : 1px solid #888;
				box-shadow : none;
			}
			.post_wrapper:hover, .post_wrapper:active {
			    -moz-box-shadow : 0 0 8px #8ce6ff;
                -webkit-box-shadow : 0 0 8px #8ce6ff;
				box-shadow : 0 0 8px #8ce6ff;
			}
			.post_header {
				position : relative;
				float : left;
				overflow : hidden;
                background-color : white;
                margin : 0 auto;
                width : 100%;
                height : 15%;
			}
			.post_body {
				position : relative;
				/* float : left; */
                background-color : white;
                margin : 0 auto;
                width : 90%;
                height : 70%;
                border: none;
			    overflow: auto;
			    outline: none;
			    -webkit-box-shadow: none;
			    -moz-box-shadow: none;
			    box-shadow: none;
			}
			.post_tail {
				position : relative;
				float : left;
                background-color : white;
                margin : 0 auto;
                width : 100%;
                height : 15%;
			}
			#newPostBtn {
				position : fixed;
				bottom : 30px;
				right : 110px;
				width : 70px;
				height : 70px;
				border-radius : 50%; 
				background-image : url("https://s3.us-east-2.amazonaws.com/flowdesk/img/post-icon_resized.png");  
				transition : all .2s ease-in-out;
				z-index : 5; 
			}
			#newPostBtn:hover {
				transform : scale(1.1);
			}
			#newPostBtn:active {
				transform : scale(0.8);
			}
			#syncBtn {
				position : fixed;
				bottom : 30px;
				right : 20px;
				width : 70px;
				height : 70px;
				border-radius : 50%; 
				background-image : url("https://s3.us-east-2.amazonaws.com/flowdesk/img/sync-icon_resized.png"); 
				transition : all .2s ease-in-out; 
				z-index : 5; 
			}
			#syncBtn:hover {
				transform : scale(1.2);
			}
			#syncBtn:active {
				transform : scale(0.8);
			}
			#searchBtn {
				position : fixed;
				bottom : 30px;
				right : 200px;
				width : 70px;
				height : 70px;
				border-radius : 50%; 
				background-image : url("https://s3.us-east-2.amazonaws.com/flowdesk/img/search-icon.png"); 
				transition : all .2s ease-in-out; 
				z-index : 5; 
			}
			#searchBtn:hover {
				transform : scale(1.1);
			}
			#searchBtn:active {
				transform : scale(0.8);
			}
			#resizeHorBtn {
				position : fixed;
				bottom : 30px;
				right : 290px;
				width : 70px;
				height : 70px;
				border-radius : 50%; 
				background-image : url("https://s3.us-east-2.amazonaws.com/flowdesk/img/resize_H.png");  
				transition : all .2s ease-in-out;
				z-index : 5; 
			}
			#resizeHorBtn:hover {
				transform : scale(1.1);
			}
			#resizeHorBtn:active {
				transform : scale(0.8);
			}
			#resizeVerBtn {
				position : fixed;
				bottom : 30px;
				right : 380px;
				width : 70px;
				height : 70px;
				border-radius : 50%; 
				background-image : url("https://s3.us-east-2.amazonaws.com/flowdesk/img/resize_V.png");  
				transition : all .2s ease-in-out;
				z-index : 5; 
			}
			#resizeVerBtn:hover {
				transform : scale(1.1);
			}
			#resizeVerBtn:active {
				transform : scale(0.8);
			}
			.BtnLabel {
				position : fixed;
				bottom : 105px;
				font-family : "consolas";
				/* font-weight : bold; */
				font-size : 14px;
				color : blue;   
			}
			.Tag {
				position : relative;
				overflow : hidden;
				top : 5px;
				left : 5px;
				margin : 5px;
				padding-left : 5px;
				padding-right : 5px;
				display : block;
				float : left;
				vertical-align: middle;
    			text-align: center;
				background-color : #96beff;
				color : white;
				font-weight : bold; 
				font-family : "Arial Black";
				font-size : 20px;
				height : 33px;
				/* width : 70px; */
				border : 2px solid #6697e8; 
			}
			.SearchTag {
				position : relative;
				overflow : hidden;
				top : 5px;
				left : 5px;
				margin : 5px;
				padding-left : 5px;
				padding-right : 5px;
				display : block;
				float : left;
				vertical-align: middle;
    			text-align: center;
				background-color : #96beff;
				color : white;
				font-weight : bold; 
				font-family : "Arial Black";
				font-size : 40px;
				height : 60px;
				/* width : 70px; */
				border : 2px solid #6697e8; 
			}
			/* Tooltip container */
			.tooltip {
			    /* position: relative;
			    display: inline-block;
			    border-bottom: 1px dotted black; */ /* If you want dots under the hoverable text */
			}

			/* Tooltip text */
			.tooltip .tooltiptext {
			    visibility: hidden;
			    width: 80px;
			    background-color: #555;
			    color: #fff;
			    text-align: center;
			    padding: 5px 0;
			    border-radius: 6px;

			    /* Position the tooltip text */
			    position: absolute;
			    z-index: 1;
			    bottom: 125%;
			    left: 50%;
			    margin-left: -40px;

			    /* Fade in tooltip */
			    opacity: 0;
			    transition: opacity 1s;
			}

			/* Tooltip arrow */
			.tooltip .tooltiptext::after {
			    content: "";
			    position: absolute;
			    top: 100%;
			    left: 50%;
			    margin-left: -5px;
			    border-width: 5px;
			    border-style: solid;
			    border-color: #555 transparent transparent transparent;
			}

			/* Show the tooltip text when you mouse over the tooltip container */
			.tooltip:hover .tooltiptext {
			    visibility: visible;
			    opacity: 1;
			}

			#searchBarContainer {
				position : fixed;
				bottom : 15px;
				width : 100%;
				height : 90px;
				z-index: 10;
			}
			#searchBar {
				background-color: white;
				position : relative;
				bottom : 7px;
				width : 95%;
				height : 90px;
				margin-left: auto;
				margin-right: auto;
				border-width: 4px;
			    border-style: solid;
			    border-radius : 22px; 
			    border-color: #4286f4;
			    z-index: 10;
			}
			#searchTagContainer {
				background-color: transparent;
				position : absolute;
				top : 5px;
				left : 10px;
				width : 97%;
				height : 82px;
				z-index: 11;
			}
			#searchTextField {
				background-color: transparent;
				position : absolute;
				top : 5px;
				left : 10px;
				width : 97%;
				height : 82px;
				font-size : 60px;
				outline: none;
				z-index: 12;
			}
			#closeBtn {
				position : absolute;
				bottom : 25px;
				right : 20px;
				width : 37px;
				height : 37px;
				background-image : url("https://s3.us-east-2.amazonaws.com/flowdesk/img/close-icon.png");  
				transition : all .2s ease-in-out;
				z-index : 13;
			}
			#closeBtn:hover {
				transform : scale(1.1);
			}
			#closeBtn:active {
				transform : scale(0.8);
			}
		</style>
		<script type="text/javascript">
			var board = []; // Posts are stored
			var sharpPressed = false; // To detect usage of Tag Grammar
			var preTagContentsLength = 0; // To revert the post content back
			// Variable post size on a scale from 0 to 3
			var horSize = 0;
			var verSize = 0;
			InputState = {
				POST : 0,
				SEARCH : 1
			};
			var inputState = InputState.POST; // default
			var inbox = new Inbox();
			var searchBarCursorPosition = 0;
			var tagsForSearch = [];
			function Post(){
				this.id = 0; // unique id
				this.order = 0; // 
				this.visible = true;
				this.present = true; 
				this.tags = [];
				this.contents = "";
				this.creation_date = new Date();
				this.modification_date = new Date(); 
			}
			Post.prototype.count = 0;
			Post.prototype.setID = function(){
				this.id = Post.prototype.count;
				Post.prototype.count = Post.prototype.count + 1; 
			};
			Post.prototype.getID = function(){
				return this.id;
			};
			function Inbox(){
				this.nPosts = 0;
				this.posts = [];
			}
			Inbox.prototype.addPost = function(newPost){
				this.nPosts++;
				this.posts.push(newPost);
			};
			Inbox.prototype.showPosts = function(){
				console.log("# of Posts : " + this.nPosts);
				console.dir(this.posts);
			};
			// When a tag is either created or deleted in the search bar, inbox is updated automatically
			function refreshInboxView(inputState){
				if(inputState === InputState.POST) return;
				// add process bar on the center later
				
				//
				var rows = document.getElementsByClassName('row');
				while(rows.length > 0){
					rows[0].parentNode.removeChild(rows[0]);
				}

				// var filteredPosts = [];
				var i, j, k;
				for(i=0;i<inbox.nPosts;i++){
					for(j=0;j<inbox.posts[i].tags.length;j++){
						console.log("inbox.posts[" + i + "].tag : " + inbox.posts[i].tags[j]);
						console.dir(inbox.posts[i].tags[j]);
						for(k=0;k<tagsForSearch.length;k++){
							console.log("tagsForSearch : " + tagsForSearch[k]);
							console.dir(tagsForSearch[k]);
							if(tagsForSearch[k].toString() == inbox.posts[i].tags[j].toString()){
								console.log("creating filted Posts..");
								createPost(inbox.posts[i].getID());
								break;
							}
						}	
					}
				}				
			};
			// id is set to -1 if the post is created newly
			function createPost(id = -1, hs = horSize, vs = verSize){
				// create <div> elements
				var row = document.createElement('div');
				var post_placeholder = document.createElement('div');
				var post_wrapper = document.createElement('div');
				var post_header = document.createElement('div');
				var post_body = document.createElement('div');
				var post_tail = document.createElement('div');
				row.className = "row";
				post_placeholder.className = "post_placeholder";
				post_wrapper.className = "post_wrapper";
				post_header.className = "post_header"; 
				post_body.className = "post_body";
				post_body.contentEditable = true;
				post_tail.className = "post_tail";
				// create "Post" object and map it to the <div> element
				if(id === -1){ // newly created
					var newPost = new Post();
					newPost.setID();
					post_body.id = newPost.getID(); 
					inbox.addPost(newPost);
				} else {
					console.log("filtered Post : " + id);
					post_body.id = id;
					var post, i;
					for(i=0;i<inbox.nPosts;i++){
						if(inbox.posts[i].id == id) {
							post = inbox.posts[i];
							break;
						}
					}
					console.log("deb");
					console.dir(post);
					post_body.innerHTML = post.contents;
					for(i=0;i<post.tags.length;i++){
						var tag = document.createElement('div');
						tag.innerHTML = post.tags[i];
						tag.className = "Tag";
						post_header.appendChild(tag);
					}
				}
				post_body.onblur = function(){
					var post, i;
					for(i=0;i<inbox.nPosts;i++){
						if(inbox.posts[i].id == this.id) {
							post = inbox.posts[i];
							break;
						}
					}		
					post.contents = this.innerHTML; 				
				}
				inbox.showPosts(); // DEBUG
				// dynamic post size
				post_placeholder.style.width = 400 + 200 * hs + "px";
				row.style.height = 400 + 200 * vs + "px";
				// stack up <div> elements
				document.body.appendChild(row);
				row.appendChild(post_placeholder);
				post_placeholder.appendChild(post_wrapper);
				post_wrapper.appendChild(post_header);
				post_wrapper.appendChild(post_body);
				post_wrapper.appendChild(post_tail);
			}
			function createTag(inputState){
				var tag = document.createElement('div');
				var textarea = document.activeElement;
				var post, i;
				console.dir(inbox);
				console.dir(textarea);
				console.log(inbox + " : " + textarea.id);
				for(i=0;i<inbox.posts.length;i++){
					if(inbox.posts[i].id == textarea.id){
						post = inbox.posts[i];
					}
				} 
				var textarea_innerHTML = textarea.innerHTML;
				var focusedPost = textarea.parentElement.firstChild;
				var regexTag = /\#[ㄱ-ㅎ|ㅏ-ㅣ|가-힣|a-z|A-Z|0-9]+/.exec(textarea_innerHTML);
				tag.innerHTML = regexTag;
				textarea.innerHTML = textarea_innerHTML.replace(regexTag, "");
				// for what?
				textarea.blur();
				textarea.focus();
				if(inputState === InputState.POST) {
					tag.className = "Tag";
					post.tags.push(regexTag);
				} else {
					tag.className = "SearchTag";
					tagsForSearch.push(regexTag);
				}				
				if(post !== undefined) {
					console.log("tags in the post : ");
					console.dir(post.tags);
				}
				console.log("tagsForSearch : " + tagsForSearch);
				focusedPost.appendChild(tag);
			}
			function createDefaultBtns(){
				var newPostBtn = document.createElement('div');
				var syncBtn = document.createElement('div');
				var searchBtn = document.createElement('div');
				var resizeHorBtn = document.createElement('div');
				var resizeVerBtn = document.createElement('div');
				var newPostBtnLabel = document.createElement('span');
				var syncBtnLabel = document.createElement('span');
				var searchBtnLabel = document.createElement('span');
				var resizeHorBtnLabel = document.createElement('span');
				var resizeVerBtnLabel = document.createElement('span');
				newPostBtn.id = "newPostBtn";
				newPostBtn.className = "tooltip";
				newPostBtn.onclick = function(){
					createPost();
				}
				syncBtn.id = "syncBtn";
				syncBtn.className = "tooltip";
				syncBtn.onclick = function(){
					// AJAX Request to send data to Memo DB
					// if already synced, do nothing
					if(false){
						return;
					}
					// sync posts in the view of the inbox only
					var unSyncedPosts = document.getElementsByClassName("post_body");
					console.log(unSyncedPosts);
					console.log(unSyncedPosts[0].innerHTML);
					var text = "dataToSend:" + unSyncedPosts[0].innerHTML;
					for(var i=0; i<unSyncedPosts.length; i++){
						text = text + unSyncedPosts[i].innerHTML;	
					}		
					console.log(text);			
					var xhttp = new XMLHttpRequest();
					xhttp.onreadystatechange = function(){
						if(this.readyState == 4 && this.status == 200){
							console.log("Sync request accepted successfully!");
						}						
					};
					xhttp.open("POST", "", true);
					xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
					xhttp.send("contents=" + text);
					console.log("AJAX Working");
				}
				searchBtn.id = "searchBtn";
				searchBtn.className = "tooltip";
				searchBtn.onclick = function(){
					inputState = InputState.SEARCH;
					tagsForSearch = []; // reset
					var searchBarContainer = document.createElement('div');
					var searchBar = document.createElement('div');
					var searchTagContainer = document.createElement('div');
					var searchTextField = document.createElement('div');
					var closeBtn = document.createElement('div');
					searchBarContainer.id = "searchBarContainer";
					searchBar.id = "searchBar";
					searchTagContainer.id = "searchTagContainer";
					searchTextField.id = "searchTextField";
					searchTextField.contentEditable = true;
					closeBtn.id = "closeBtn";
					closeBtn.onclick = function(){
						inputState = InputState.POST;
						//searchBarContainer.innerHTML = "";
						document.body.removeChild(searchBarContainer);
					}
					searchBar.appendChild(searchTagContainer);
					searchBar.appendChild(searchTextField);
					searchBar.appendChild(closeBtn);
					searchBarContainer.appendChild(searchBar);
					document.body.appendChild(searchBarContainer);
					searchTextField.focus();
				}
				resizeHorBtn.id = "resizeHorBtn";
				resizeHorBtn.className = "tooltip";
				resizeHorBtn.onclick = function(){
					var x = document.getElementsByClassName("post_placeholder");
					var i;
					var tmp;
					horSize = horSize + 1;
					if(horSize > 3){
						horSize = 0;
					}
					for (i = 0; i < x.length; i++) {
					    x[i].style.width = 400 + 200 * horSize + "px";
					}
				}
				resizeVerBtn.id = "resizeVerBtn";
				resizeVerBtn.className = "tooltip";
				resizeVerBtn.onclick = function(){
					var x = document.getElementsByClassName("row");
					var i;
					var tmp;
					verSize = verSize + 1;
					if(verSize > 3){
						verSize = 0;
					}
					for (i = 0; i < x.length; i++) {
					    x[i].style.height = 400 + 200 * verSize + "px";
					}
				}
				newPostBtnLabel.className = "tooltiptext";
				newPostBtnLabel.innerHTML = "Create" + "<br />" + "New Post";
				//newPostBtnLabel.style.right = "112px";
				syncBtnLabel.className = "tooltiptext";				
				syncBtnLabel.innerHTML = "Sync";
				searchBtnLabel.className = "tooltiptext";				
				searchBtnLabel.innerHTML = "Search" + "<br />" +"by Tags";
				resizeHorBtnLabel.className = "tooltiptext";
				resizeHorBtnLabel.innerHTML = "Resize " + "<br />" + " horizontally ";
				resizeVerBtnLabel.className = "tooltiptext";
				resizeVerBtnLabel.innerHTML = "Resize " + "<br />" + " vetically ";
				//syncBtnLabel.style.right = "22px";
				document.body.appendChild(newPostBtn);
				document.body.appendChild(syncBtn);
				document.body.appendChild(searchBtn);
				document.body.appendChild(resizeHorBtn);
				document.body.appendChild(resizeVerBtn);
				newPostBtn.appendChild(newPostBtnLabel);
				syncBtn.appendChild(syncBtnLabel);
				searchBtn.appendChild(searchBtnLabel);
				resizeHorBtn.appendChild(resizeHorBtnLabel);
				resizeVerBtn.appendChild(resizeVerBtnLabel);				
			}
			function keyManager(e){
				var code = e.keyCode? e.keyCode : e.which;
				console.log(code);
				if(code == 222){	// When " is typed
					createPost();
				} else if(code == 51) {	// when "#" key is pressed
					if(sharpPressed == false) {
						sharpPressed = true;
						//preTagContentsLength = document.activeElement.innerHTML.length;
						//console.log("preTagContentsLength : " + document.activeElement.innerHTML.length);
					} else {
						// To 
					}
				} else if(code == 32 && sharpPressed == true) { // when "white space" key is pressed
					sharpPressed = false;
					createTag(inputState);
					refreshInboxView(inputState);
				} else if ((code == 27 || code == 13) && inputState === InputState.SEARCH) {
					var searchBarContainer = document.getElementById('searchBarContainer');
					document.body.removeChild(searchBarContainer);
				}
			}
			window.onkeydown = keyManager;
			window.onload = function(){
				createDefaultBtns();
			}
		</script>
	</head>
	<body>
		<div id="maintitle_wrapper">
			<div id="maintitle_1">Flowdesk</div>
			<div id="maintitle_2">Post Stack</div>
		</div>
		<div id="subtitle_wrapper">
			<div id="subtitle">Logged in as "JERRY AN"</div>
		</div>
	</body>
</html>










